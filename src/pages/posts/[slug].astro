---
import { getAllPostsWithSlug } from "../../lib/cosmic";
import Layout from "../../layouts/Layout.astro";
import PostBody from "../../components/PostBody";
import { Image } from "@astrojs/image/components";
import { parseISO, format } from "date-fns";

interface Post {
  slug: string;
  title: string;
}

export async function getStaticPaths() {
  const data = (await getAllPostsWithSlug()) || [];

  return data.map((post: Post) => {
    return {
      params: { slug: post.slug },
      props: { post },
    };
  });
}

const { slug } = Astro.params;
const { post } = Astro.props;
---

<Layout title={post.title}>
  <main class="flex flex-col max-w-2xl mx-auto my-12 px-3 lg:px-0">
    <article>
      <h1 class="text-4xl font-bold">{post.title}</h1>
      <span class="text-xs tracking-widest font-bold"
        >{format(parseISO(post.created_at), "MM/dd/yyyy")}
      </span>
      <Image
        src={post.metadata.cover_image.imgix_url}
        format="webp"
        width={1200}
        aspectRatio={16 / 9}
        quality={50}
        alt=""
        class={"rounded-md shadow-lg my-12"}
      />
      <PostBody content={post.metadata.content} />
    </article>
  </main>
</Layout>
